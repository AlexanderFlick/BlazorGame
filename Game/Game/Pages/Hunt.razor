@page "/hunt"
@using Game.Data;
@using Game.Services;
@inject IPlayerMonsterService MonsterService
@inject IAmberService AmberService
@inject NavigationManager NavigationManager

<div style="text-align:center">
    <h3><b>Hunt For Dinosaur Fossils</b></h3>
    @if (!HasEnough)
    {
        <div class="alert alert-danger" role="alert">
            <p>Go gather more amber to find new fossils!</p>
            <button class="btn btn-danger" @onclick="RedirectToGold">Go Get More Amber</button>
        </div>
    }
    <p>Current Amber: @player.Amber</p>
    <p>Amber Needed to Hunt for New Fossils: @player.AmberPerMonster</p>
    <p>Current Fossil Count: @player.Fossils.Count()/@player.MaxPartySize</p>    
    <button class="btn btn-primary" @onclick="GetNewFossil">Get New Dinosaur</button>
</div>

@code {
    [CascadingParameter]
    public Player player { get; set; }

    public bool HasEnough { get; set; } = true;

    private void GetNewFossil()
    {
        var enoughGold = AmberService.HasEnough(player, player.AmberPerMonster);
        if (enoughGold)
        {
            HasEnough = true;
            player.Amber = AmberService.Pay(player.AmberPerMonster, player.Amber);
            player = MonsterService.HuntForMonster(player);
        }
        else
        {
            HasEnough = false;
        }
    }

    private void RedirectToGold()
    {
        NavigationManager.NavigateTo("/amber");
    }
}
